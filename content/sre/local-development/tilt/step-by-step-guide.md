# Step by Step Guide

1) Enable sandbox namespace/project/environment for your tenant

2) Login to cluster

```bash
oc login --token=<TOKEN> --server=<SERVER>
```

3) Switch project to sandbox namespace/project/environment

```bash
oc project <MY-SANDBOX>
```

4) Login to docker registry

**MacOS**

```bash
HOST=$(oc get route default-route -n openshift-image-registry --template='{{ .spec.host }}')
docker login -u username -p $(oc whoami -t) $HOST
```

NOTE: If oc command fails then ask SCA (SAAP Cluster Admin) to provide you the route

5) Add helm chart repos (Optional)

If you reference helm charts from private registry then you first need to add it

```bash
cd deploy;

# helm credentials can be found in vault or in a secret in build namespace
helm repo add stakater-nexus <private repo url> --username helm-user-name --password ********; 
```

6) Update helm dependencies

```bash
helm dependency update

cd ..
```

7) Add Tiltfile to your application 

[Here](Tiltfile) is a sample Tiltfile for a Java based project with a specific Dockerfile.

8) Update `local_resource` in the Tiltfile

Make sure the app jar file name under `local_resource` matches with the jar name generated by your application in target folder
 
9) Add `tilt_options.json` file to your application

Should be created locally by everyone in base directory and it should have following content as per the user. User email in `allow_k8s_contexts` should be same email that is allowed to use tilt in gitOps-config.

```json
{
    "namespace": "tilt-username-sandbox",
    "default_registry": "image-registry-openshift-image-registry.apps.[CLUSTER-NAME].[CLUSTER-ID].kubeapp.cloud/{}",
    "allow_k8s_contexts": "tilt-username-sandbox/api-[CLUSTER-NAME]-[CLUSTER-ID]-kubeapp-cloud:6443/user@email.com"
}
```

NOTE: Remember `tilt_options.json` should be git ignored

10) Update `.gitigore`

```
# Tilt
tilt_options.json
tilt_modules/

# Helm
/deploy/charts
```

11) Add `.tiltignore` with the following content

```
**/charts
**/tmpcharts
```

12) Add `values-local.yaml` in a `tilt` folder in base application directory. 

`values-local.yaml` should contain the following content. Make sure that replica count should always be 1.

```yaml
application:

  space:
    enabled: false
  
  namespace:
    enabled: false

  deployment:
    imagePullSecrets: null

    # Tilt live update only supports one replica
    replicas: 1
```

13) Update docker file

To be able to run the sample [Tiltfile](Tiltfile), it needs a docker file in a specific format. [Here](Dockerfile) is a sample dockerfile for Java and springboot based project.

13) Run `tilt up` at base directory 

Press space key to view the progress in Tilt web UI. The application should be running in the namespace used in `tilt_options.json` file.

14) Run `tilt down` to delete the application and related configuration from the namespace
